<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Champs Core JS - Testes</title>
  <link rel="icon" href="../assets/favicon.ico">
  <link rel="stylesheet" href="../assets/JChamps.css">
  <link rel="stylesheet" href="../assets/loader.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    .box { margin-bottom: 2rem; }
    .btn { padding: 0.5rem 1rem; margin: 0 0.5rem 0.5rem 0; }
    .template-badge { font-size: .8rem; }
    .card-demo { min-height: 120px; }
    textarea#customLoaderHtml { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
  </style>
</head>
<body data-box_load_effect="true">

<div class="container">
  <h1 class="mb-4">Champs Core - Testes</h1>

  <!-- NAV -->
  <nav class="mb-4">
    <a class="btn btn-outline-secondary btn-sm" href="#loader-tests">Loader Tests</a>
    <a class="btn btn-outline-secondary btn-sm" href="#ajax-class">AJAX Classe</a>
    <a class="btn btn-outline-secondary btn-sm" href="#checkbox">Checkbox Group</a>
    <a class="btn btn-outline-secondary btn-sm" href="#datalist">Datalist</a>
    <a class="btn btn-outline-secondary btn-sm" href="#cep">CEP</a>
    <a class="btn btn-outline-secondary btn-sm" href="#seguro">Visualiza√ß√£o Segura</a>
  </nav>

  <!-- ===== LOADER TESTS ===== -->
  <div id="loader-tests" class="box">
    <h3 class="mb-3">Testes do Loader</h3>

    <div class="d-flex flex-wrap align-items-center mb-2">
      <span class="me-2 template-badge text-muted">Templates r√°pidos:</span>
      <button class="btn btn-outline-primary" id="btnTplDefault">Default</button>
      <button class="btn btn-outline-primary" id="btnTplWine">Wine</button>
      <button class="btn btn-outline-primary" id="btnTplWineAnimated">Wine Animated</button>
      <button class="btn btn-outline-primary" id="btnTplMinimal">Minimal</button>
      <button class="btn btn-outline-primary" id="btnTplCornetas">Cornetas</button>
      <button class="btn btn-outline-primary" id="btnTplOrg">OrganizzeMe</button>
    </div>

    <div class="d-flex flex-wrap align-items-center mb-3">
      <button class="btn btn-secondary" id="btnShowLoader">Mostrar (Overlay Global)</button>
      <button class="btn btn-secondary" id="btnHideLoader">Esconder (Overlay Global)</button>
      <button class="btn btn-info" id="btnShowAndAutoHide">Mostrar 1.5s</button>
    </div>

    <div class="row g-3 align-items-stretch">
      <div class="col-md-6">
        <label for="customLoaderHtml" class="form-label">HTML do Loader (custom):</label>
        <textarea id="customLoaderHtml" class="form-control" rows="10">
<div class="wine-loader text-center">
  <svg width="64" height="64" viewBox="0 0 64 64" aria-label="Carregando..." role="img" class="wine-glass">
    <path d="M16 4h32c0 10-8 18-16 18S16 14 16 4z" fill="#800020"/>
    <path d="M32 22c-8 0-16-8-16-18h32c0 10-8 18-16 18z" fill="none" stroke="#3a3a3a" stroke-width="2"/>
    <path d="M32 22v22" stroke="#3a3a3a" stroke-width="3"/>
    <path d="M22 44h20" stroke="#3a3a3a" stroke-width="3" stroke-linecap="round"/>
  </svg>
  <div class="small mt-2">Carregando...</div>
</div>
        </textarea>
        <div class="mt-2">
          <button class="btn btn-success" id="btnUseCustomAndShow">Usar HTML acima &amp; Mostrar</button>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card card-demo position-relative" id="cardTarget">
          <div class="card-body">
            <h5 class="card-title">Loader Local (no Card)</h5>
            <p class="card-text">Use os bot√µes abaixo para exibir o loader dentro deste card.</p>
            <button class="btn btn-outline-dark" id="btnShowLocal">Mostrar Local</button>
            <button class="btn btn-outline-dark" id="btnHideLocal">Esconder Local</button>
            <button class="btn btn-outline-dark" id="btnLocalAutoHide">Mostrar Local 1.5s</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="box">
    <h5>Champs Core - AJAX por Classe</h5>
    <form name="form_ajax" action="https://httpbin.org/post" method="POST">
      <input type="text" name="nome" placeholder="Seu nome" class="form-control mb-2">
      <button type="button"
              class="btn btn-success champs_send_post_on_click"
              data-route="https://httpbin.org/post"
              data-with_inputs="true"
              data-target_form_name="form_ajax"
              data-type="success"
              data-message="Enviado com sucesso!">
        Enviar via AJAX (classe)
      </button>
    </form>
  </div>

  <div class="box">
    <label class="form-check">
      <input type="checkbox" class="form-check-input champs_checkbox_parent_select"
             data-group="grupo1"
             data-counter_element="#contador"
             data-total_element="#soma">
      <span class="form-check-label">Selecionar todos</span>
    </label>

    <div class="ms-3">
      <label class="form-check"><input type="checkbox" class="form-check-input champs_checkbox_child_select" data-group="grupo1" data-counter_element="#contador" data-total_element="#soma" data-value_to_sum="10"> Item 1 (10)</label><br>
      <label class="form-check"><input type="checkbox" class="form-check-input champs_checkbox_child_select" data-group="grupo1" data-counter_element="#contador" data-total_element="#soma" data-value_to_sum="20"> Item 2 (20)</label><br>
      <label class="form-check"><input type="checkbox" class="form-check-input champs_checkbox_child_select" data-group="grupo1" data-counter_element="#contador" data-total_element="#soma" data-value_to_sum="30"> Item 3 (30)</label>
    </div>

    <p class="mt-2">Total selecionados: <span id="contador">0</span></p>
    <p>Soma total: <span id="soma">0</span></p>
  </div>

  <div class="box">
    <label for="estado" class="form-label">Estado</label>
    <select id="estado"
            class="form-select"
            data-group="local"
            data-group_index="1"
            data-child_selector="#cidade"
            data-element_id="estado">
      <option value="" disabled selected>Selecione um estado</option>
      <option value="SP">S√£o Paulo</option>
      <option value="RJ">Rio de Janeiro</option>
    </select>
  </div>

  <div class="box">
    <label for="cidade" class="form-label">Cidade</label>
    <select id="cidade"
            class="form-select"
            data-group="local"
            data-group_index="2">
      <option value="" disabled selected>Selecione o estado primeiro</option>
    </select>
  </div>

  <div class="box">
    <h5>Formul√°rio de Edi√ß√£o</h5>
    <input type="text" class="form-control nome mb-2" placeholder="Nome">
    <input type="email" class="form-control email mb-2" placeholder="Email">
    <select class="form-select nivel mb-2">
      <option value="">Selecione o n√≠vel</option>
      <option value="admin">Administrador</option>
      <option value="user">Usu√°rio</option>
    </select>
    <button id="btnPreencherForm" class="btn btn-warning">Preencher Dados (formfiller)</button>
  </div>

  <div class="box">
    <h5>Busca com Datalist</h5>
    <input list="nomes" class="form-control datalist_input_on_change mb-2" placeholder="Digite um nome" data-datalist_clear_after_change="true">

    <datalist id="nomes">
      <option id="1" data-value="1" value="Beto">
      <option id="2" data-value="2" value="Pedro">
      <option id="3" data-value="3" value="Cadu">
    </datalist>

    <select class="form-select datalist_target_element_class">
      <option value="">ID selecionado aparecer√° aqui</option>
      <option value="1">Beto</option>
      <option value="2">Pedro</option>
      <option value="3">Cadu</option>
    </select>
  </div>

  <div class="box">
    <h5>Consulta de CEP (ViaCEP)</h5>
    <input type="text" class="form-control champs_zipcode_search mb-2" placeholder="Digite o CEP (ex: 01001000)">

    <input type="text" class="form-control champs_zipcode_search_street mb-2" placeholder="Rua">
    <input type="text" class="form-control champs_zipcode_search_complement mb-2" placeholder="Complemento do endere√ßo">
    <input type="text" class="form-control champs_zipcode_search_neighborhood mb-2" placeholder="Bairro">
    <input type="text" class="form-control champs_zipcode_search_city mb-2" placeholder="Cidade">
    <input type="text" class="form-control champs_zipcode_search_state mb-2" placeholder="UF">
    <input type="text" class="form-control champs_zipcode_search_state_name mb-2" placeholder="Estado">
    <input type="text" class="form-control champs_zipcode_search_state_region mb-2" placeholder="Regi√£o">
    <input type="text" class="form-control champs_zipcode_search_state_ddd mb-2" placeholder="DDD">

    <div class="text-danger champs_zipcode_search_error fw-bold mt-2"></div>
    <pre class="bg-light p-3 border mt-3 champs_zipcode_search_result_json" style="white-space:pre-wrap;"></pre>

  </div>

  <div class="box">
    <h5>Visualiza√ß√£o Segura com Layout BS5</h5>

    <div class="mb-3">
      <label for="senhaConta" class="form-label">Senha</label>
      <div class="input-group">
        <input type="password" class="form-control grupo_sensivel" id="senhaConta" value="Segredo123">
        <button class="btn btn-outline-secondary champs_toggle_visibility"
                type="button"
                data-hidden_group="grupo_sensivel"
                data-icon_show="üëÅ"
                data-icon_hide="üôà">
          üëÅ
        </button>
      </div>
    </div>
    <div class="box">
      <h5>Copia texto de elemento com um click</h5>

      <span id="serial-abc">21915274269470051103110311PBA86</span>

      <button class="btn btn-sm btn-outline-secondary" data-champs-copy-from="#serial-abc">
        <i class="bi bi-clipboard"></i> Copiar N¬∫ de S√©rie
      </button>
    </div>

    <div class="form-floating mb-3">
      <input type="text" class="form-control grupo_sensivel" id="valorConta" value="R$ 10.000,00" placeholder="Valor da Conta">
      <label for="valorConta">Valor da Conta</label>
    </div>
  </div>

  <div class="mb-5">
  </div>

</div>

<script type="module">
  import Loader from '../src/Loader.js';
  import NavLoader from '../src/loader.navigation.js';
  import * as Templates from '../src/loader.templates.js';

  import { init as initAjaxForm } from '../src/AjaxForm.js';
  import CheckboxGroup from '../src/CheckboxGroup.js';
  import ModalManager from '../src/ModalManager.js';
  import FormPopulation from '../src/FormPopulation.js';
  import FormFiller from '../src/FormFiller.js';
  import DatalistManager from '../src/DatalistManager.js';
  import ZipcodeSearch from '../src/ZipcodeSearch.js';
  import VisibilityToggle from '../src/VisibilityToggle.js';
  import CopyText from "../src/CopyText.js";

  // ---- Inicializa√ß√µes padr√£o ----
  VisibilityToggle.init();
  ZipcodeSearch.init();
  DatalistManager.init();
  if (Loader && typeof Loader.createLoader === 'function') Loader.createLoader(); // compat API antiga
  if (Loader && typeof Loader.initOnNavigation === 'function') {
    Loader.initOnNavigation();
  } else if (NavLoader && typeof NavLoader.initOnNavigation === 'function') {
    NavLoader.initOnNavigation();
  }
  CheckboxGroup.init();
  initAjaxForm();
  CopyText.init();

  // Helpers
  function registerTemplate(name, html) {
    if (Loader?.registerTemplate) Loader.registerTemplate(name, html);
  }
  function useTemplate(name, html) {
    if (Loader?.use) {
      if (name) Loader.use(name);
      else if (html) Loader.setTemplate?.(html);
    } else {
      if (html) Loader.setTemplate?.(html);
    }
  }

  // Registrar templates
  registerTemplate('wine', Templates.loaderWine ?? '');
  registerTemplate('wineAnimated', Templates.loaderWineAnimated ?? '');
  registerTemplate('minimal', Templates.loaderMinimal ?? '');
  registerTemplate('cornetas', Templates.loaderCornetas ?? '');
  registerTemplate('org', Templates.loaderOrganizzeMe ?? '');

  // Bot√µes
  document.getElementById('btnTplDefault').addEventListener('click', () => useTemplate('default', null));
  document.getElementById('btnTplWine').addEventListener('click', () => useTemplate('wine', Templates.loaderWine ?? null));
  document.getElementById('btnTplWineAnimated').addEventListener('click', () => useTemplate('wineAnimated', Templates.loaderWineAnimated ?? null));
  document.getElementById('btnTplMinimal').addEventListener('click', () => useTemplate('minimal', Templates.loaderMinimal ?? null));
  document.getElementById('btnTplCornetas').addEventListener('click', () => useTemplate('cornetas', Templates.loaderCornetas ?? null));
  document.getElementById('btnTplOrg').addEventListener('click', () => useTemplate('org', Templates.loaderOrganizzeMe ?? null));

  // Overlay global
  document.getElementById('btnShowLoader').addEventListener('click', () => Loader.show());
  document.getElementById('btnHideLoader').addEventListener('click', () => Loader.hide());
  document.getElementById('btnShowAndAutoHide').addEventListener('click', () => { Loader.show(); setTimeout(() => Loader.hide(), 1500); });

  // Local
  const cardTarget = document.getElementById('cardTarget');
  document.getElementById('btnShowLocal').addEventListener('click', () => Loader.show(cardTarget));
  document.getElementById('btnHideLocal').addEventListener('click', () => Loader.hide(cardTarget));
  document.getElementById('btnLocalAutoHide').addEventListener('click', () => { Loader.show(cardTarget); setTimeout(() => Loader.hide(cardTarget), 1500); });

  // Custom HTML
  document.getElementById('btnUseCustomAndShow').addEventListener('click', () => {
    const html = document.getElementById('customLoaderHtml').value;
    if (Loader?.setTemplate) Loader.setTemplate(html);
    Loader.show();
    setTimeout(() => Loader.hide(), 1500);
  });

  // ESC esconde overlay
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') Loader.hide(); });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
