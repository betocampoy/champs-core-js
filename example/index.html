<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Champs Core JS - Testes</title>
  <link rel="icon" href="../assets/favicon.ico">
  <link rel="stylesheet" href="../assets/JChamps.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    .box { margin-bottom: 2rem; }
    .btn { padding: 0.5rem 1rem; margin-right: 0.5rem; }
  </style>
</head>
<body data-box_load_effect="true">

<div class="container">
  <h1 class="mb-4">Champs Core - Testes</h1>

  <div class="box">
    <button id="btnShowLoader" class="btn btn-secondary">Mostrar Loader</button>
    <button id="btnHideLoader" class="btn btn-secondary">Esconder Loader</button>
    <button id="btnToggleModal" class="btn btn-primary">Abrir Modal Simples</button>
    <button id="btnAbrirModalBS5" class="btn btn-info">Abrir Modal BS5</button>
  </div>

  <div class="box">
    <h5>Champs Core - AJAX por Classe</h5>
    <form name="form_ajax" action="https://httpbin.org/post" method="POST">
      <input type="text" name="nome" placeholder="Seu nome" class="form-control mb-2">
      <button type="button"
              class="btn btn-success champs_send_post_on_click"
              data-route="https://httpbin.org/post"
              data-with_inputs="true"
              data-target_form_name="form_ajax"
              data-type="success"
              data-message="Enviado com sucesso!">
        Enviar via AJAX (classe)
      </button>
    </form>
  </div>

  <div class="box">
    <label class="form-check">
      <input type="checkbox" class="form-check-input champs_checkbox_parent_select"
             data-group="grupo1"
             data-counter_element="#contador"
             data-total_element="#soma">
      <span class="form-check-label">Selecionar todos</span>
    </label>

    <div class="ms-3">
      <label class="form-check"><input type="checkbox" class="form-check-input champs_checkbox_child_select" data-group="grupo1" data-counter_element="#contador" data-total_element="#soma" data-value_to_sum="10"> Item 1 (10)</label><br>
      <label class="form-check"><input type="checkbox" class="form-check-input champs_checkbox_child_select" data-group="grupo1" data-counter_element="#contador" data-total_element="#soma" data-value_to_sum="20"> Item 2 (20)</label><br>
      <label class="form-check"><input type="checkbox" class="form-check-input champs_checkbox_child_select" data-group="grupo1" data-counter_element="#contador" data-total_element="#soma" data-value_to_sum="30"> Item 3 (30)</label>
    </div>

    <p class="mt-2">Total selecionados: <span id="contador">0</span></p>
    <p>Soma total: <span id="soma">0</span></p>
  </div>

  <div class="box">
    <label for="estado" class="form-label">Estado</label>
    <select id="estado"
            class="form-select"
            data-group="local"
            data-group_index="1"
            data-child_selector="#cidade"
            data-element_id="estado">
      <option value="" disabled selected>Selecione um estado</option>
      <option value="SP">S√£o Paulo</option>
      <option value="RJ">Rio de Janeiro</option>
    </select>
  </div>

  <div class="box">
    <label for="cidade" class="form-label">Cidade</label>
    <select id="cidade"
            class="form-select"
            data-group="local"
            data-group_index="2">
      <option value="" disabled selected>Selecione o estado primeiro</option>
    </select>
  </div>

  <div class="box">
    <h5>Formul√°rio de Edi√ß√£o</h5>
    <input type="text" class="form-control nome mb-2" placeholder="Nome">
    <input type="email" class="form-control email mb-2" placeholder="Email">
    <select class="form-select nivel mb-2">
      <option value="">Selecione o n√≠vel</option>
      <option value="admin">Administrador</option>
      <option value="user">Usu√°rio</option>
    </select>
    <button id="btnPreencherForm" class="btn btn-warning">Preencher Dados (formfiller)</button>
  </div>

  <div class="box">
    <h5>Busca com Datalist</h5>
    <input list="nomes" class="form-control datalist_input_on_change mb-2" placeholder="Digite um nome" data-datalist_clear_after_change="true">

    <datalist id="nomes">
      <option id="1" data-value="1" value="Beto">
      <option id="2" data-value="2" value="Pedro">
      <option id="3" data-value="3" value="Cadu">
    </datalist>

    <select class="form-select datalist_target_element_class">
      <option value="">ID selecionado aparecer√° aqui</option>
      <option value="1">Beto</option>
      <option value="2">Pedro</option>
      <option value="3">Cadu</option>
    </select>
  </div>

  <div class="box">
    <h5>Consulta de CEP (ViaCEP)</h5>
    <input type="text" class="form-control champs_zipcode_search mb-2" placeholder="Digite o CEP (ex: 01001000)">

    <input type="text" class="form-control champs_zipcode_search_street mb-2" placeholder="Rua">
    <input type="text" class="form-control champs_zipcode_search_complement mb-2" placeholder="Complemento do endere√ßo">
    <input type="text" class="form-control champs_zipcode_search_neighborhood mb-2" placeholder="Bairro">
    <input type="text" class="form-control champs_zipcode_search_city mb-2" placeholder="Cidade">
    <input type="text" class="form-control champs_zipcode_search_state mb-2" placeholder="UF">
    <input type="text" class="form-control champs_zipcode_search_state_name mb-2" placeholder="Estado">
    <input type="text" class="form-control champs_zipcode_search_state_region mb-2" placeholder="Regi√£o">
    <input type="text" class="form-control champs_zipcode_search_state_ddd mb-2" placeholder="DDD">

    <div class="text-danger champs_zipcode_search_error fw-bold mt-2"></div>
    <pre class="bg-light p-3 border mt-3 champs_zipcode_search_result_json" style="white-space:pre-wrap;"></pre>

  </div>

  <div class="box">
    <h5>Visualiza√ß√£o Segura com Layout BS5</h5>

    <div class="mb-3">
      <label for="senhaConta" class="form-label">Senha</label>
      <div class="input-group">
        <input type="password" class="form-control grupo_sensivel" id="senhaConta" value="Segredo123">
        <button class="btn btn-outline-secondary champs_toggle_visibility"
                type="button"
                data-hidden_group="grupo_sensivel"
                data-icon_show="üëÅ"
                data-icon_hide="üôà">
          üëÅ
        </button>
      </div>
    </div>
    <div class="box">
      <h5>Copia texto de elemento com um click</h5>

      <span id="serial-abc">21915274269470051103110311PBA86</span>

      <button class="btn btn-sm btn-outline-secondary" data-champs-copy-from="#serial-abc">
        <i class="bi bi-clipboard"></i> Copiar N¬∫ de S√©rie
      </button>
    </div>

    <div class="form-floating mb-3">
      <input type="text" class="form-control grupo_sensivel" id="valorConta" value="R$ 10.000,00" placeholder="Valor da Conta">
      <label for="valorConta">Valor da Conta</label>
    </div>
  </div>

  <div class="mb-5">
  </div>

</div>

<script type="module">
  import Loader from '../src/Loader.js';
  import { init as initAjaxForm } from '../src/AjaxForm.js';
  import CheckboxGroup from '../src/CheckboxGroup.js';
  import ModalManager from '../src/ModalManager.js';
  import FormPopulation from '../src/FormPopulation.js';
  import FormFiller from '../src/FormFiller.js';
  import DatalistManager from '../src/DatalistManager.js';
  import ZipcodeSearch from '../src/ZipcodeSearch.js';
  import VisibilityToggle from '../src/VisibilityToggle.js';
  import CopyText from "../src/CopyText.js";

  VisibilityToggle.init();
  ZipcodeSearch.init();
  DatalistManager.init();
  Loader.createLoader();
  Loader.initOnNavigation();
  CheckboxGroup.init();
  initAjaxForm();
  CopyText.init();

  document.getElementById('btnShowLoader').addEventListener('click', () => Loader.show());
  document.getElementById('btnHideLoader').addEventListener('click', () => Loader.hide());

  document.getElementById('btnToggleModal').addEventListener('click', () => {
    ModalManager.showBasicModal(`
      <div class="champs_modal_header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Ol√°, Beto!</h5>
        <button class="btn-close champs_modal_close" onclick="document.getElementById('champs_modal').classList.add('hide');document.getElementById('champs_modal_fade').classList.add('hide')" aria-label="Fechar"></button>
      </div>
      <div class="champs_modal_body mt-3">
        <p>Este √© um modal exibido via Champs Core JS com Bootstrap 5!</p>
      </div>
    `);
  });

  document.getElementById('btnAbrirModalBS5').addEventListener('click', () => {
    const modalId = 'modalBs5Example';
    const modalHtml = `
      <div class="modal fade" id="${modalId}" tabindex="-1" aria-labelledby="${modalId}_label" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="${modalId}_label">Modal BS5 - Champs</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
              <p>Este √© um modal padr√£o do Bootstrap 5 exibido pelo ModalManager.</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
          </div>
        </div>
      </div>`;
    ModalManager.showBS5Modal(modalId, modalHtml);
  });

  document.getElementById('estado').addEventListener('change', (e) => {
    const estado = e.target.value;

    const cidades = {
      SP: {
        counter: 3,
        data: {
          'sao_paulo': 'S√£o Paulo',
          'campinas': 'Campinas',
          'santos': 'Santos'
        }
      },
      RJ: {
        counter: 2,
        data: {
          'rio': 'Rio de Janeiro',
          'niteroi': 'Niter√≥i'
        }
      }
    };

    const fakeResponse = {
      data_post: {
        element_id: 'estado',
        child_selector: '#cidade',
        group: 'local',
        group_index: 1
      },
      data_response: cidades[estado] ?? { counter: 0, data: {} }
    };

    FormPopulation.populate(fakeResponse);
  });

  window.logEdicao = () => {
    console.log('‚öôÔ∏è Callback ap√≥s preenchimento executado (logEdicao)');
  };

  document.getElementById('btnPreencherForm').addEventListener('click', () => {
    const mockData = {
      nome: 'Beto Campoy',
      email: 'beto@champscore.com',
      nivel: 'admin',
      jsCustomFunction: 'logEdicao'
    };

    FormFiller.fill(mockData);
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') Loader.hide();
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
